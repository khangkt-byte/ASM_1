@model ASM_1.Models.Food.Invoice

@{
    ViewData["Title"] = "Chi tiết hóa đơn";
}

<h2>Chi tiết hóa đơn @Model.InvoiceCode</h2>

<hr />

<div class="mb-3">
    <strong>Bàn:</strong> @string.Join(", ", Model.TableInvoices.Select(ti => ti.Table!.TableName))<br />
    <strong>Ngày tạo:</strong> @Model.CreatedDate.ToString("dd/MM/yyyy HH:mm")<br />
    <strong>Trạng thái:</strong>
    <span class="badge bg-@(Model.Status == "Paid" ? "success" : "warning")">
        @Model.Status
    </span><br />
    <strong>Ghi chú:</strong> @Model.Notes
</div>

<table class="table table-hover table-bordered">
    <thead class="table-light">
        <tr>
            <th>Tên món</th>
            <th>Tùy chọn</th>
            <th>Phụ chọn (Topping)</th>
            <th>Số lượng</th>
            <th>Đơn giá</th>
            <th>Thành tiền</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var detail in Model.InvoiceDetails)
        {
            <tr>
                <td>@detail.FoodItem?.Name</td>
                <td>
                    @if (detail.InvoiceDetailFoodOptions != null && detail.InvoiceDetailFoodOptions.Any())
                    {
                        @string.Join(", ", detail.InvoiceDetailFoodOptions.Select(o => o.FoodOption.OptionName))
                    }
                    else
                    {
                        <span>-</span>
                    }
                </td>
                <td>@detail.Quantity</td>
                <td>@detail.UnitPrice.ToString("N0") ₫</td>
                <td>@detail.SubTotal.ToString("N0") ₫</td>
            </tr>
        }
    </tbody>
</table>

<div class="mt-4 text-end">
    <p><strong>Tổng cộng:</strong> @Model.TotalAmount.ToString("N0") ₫</p>
    <p>
        <strong>Giảm giá:</strong>
        @(Model.Discount != null ? Model.Discount.Code + " (" + Model.Discount.Percent + "%)" : "-")
    </p>
    <h4><strong>Thành tiền:</strong> @Model.FinalAmount.ToString("N0") ₫</h4>
</div>

<a asp-action="Index" class="btn btn-secondary mt-3">← Quay lại danh sách</a>
